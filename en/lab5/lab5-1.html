<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<html lang="en" class="js csstransforms3d">
<head>
  <meta charset="utf-8">
  <meta property="og:title" content="SAP HANA on AWS Advanced WorkShop" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="generator" content="Hugo 0.74.3" />
  <meta name="description" content="SAP HANA on AWS Advanced WorkShop">
<meta name="author" content="Amazon AWS">

  <link rel="shortcut icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />
<link rel="icon" href="https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico" type="image/ico" />

  <title>Task 01. Change HANA HSR Config :: SAP HANA on AWS Advanced WorkShop</title>

  
  <link href="../../css/nucleus.css" rel="stylesheet">
  <link href="../../css/fontawesome-all.min.css" rel="stylesheet">
  <link href="../../css/hybrid.css" rel="stylesheet">
  <link href="../../css/featherlight.min.css" rel="stylesheet">
  <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
  <link href="../../css/auto-complete.css" rel="stylesheet">
  <link href="../../css/atom-one-dark-reasonable.css" rel="stylesheet">
  <link href="../../css/theme.css" rel="stylesheet">
  <link href="../../css/hugo-theme.css" rel="stylesheet">
  
  <link href="../../css/theme-aws.css" rel="stylesheet">
  

  <script src="../../js/jquery-3.3.1.min.js"></script>

  <style>
    :root #header + #content > #left > #rlblock_left{
        display:none !important;
    }
    
      :not(pre) > code + span.copy-to-clipboard {
          display: none;
      }
    
  </style>
  
</head>

<body class="" data-url="../../en/lab5/lab5-1.html">
  <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div>
    <a href="../../" title="Go home">
        <img style="vertical-align:middle" src="../../images/logo.png" height="70px" />
    </a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js"></script>
<script type="text/javascript" src="../../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "\/en";
    
</script>
<script type="text/javascript" src="../../js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/en/intro.html" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="../../en/intro.html">
          <b>1. </b>Introduction
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/lab1.html" title="Lab 01. Setup Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab1.html">
          <b>2. </b>Lab 01. Setup Cluster
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab1/lab1-1.html" title="Task 01. SAP HANA Quick Starts" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab1/lab1-1.html">
          <b> </b>Task 01. SAP HANA Quick Starts
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/lab2.html" title="Lab 02. Monitor Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab2.html">
          <b>3. </b>Lab 02. Monitor Cluster
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab2/lab2-1.html" title="Task 01. Verify Created Resources" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab2/lab2-1.html">
          <b> </b>Task 01. Verify Created Resources
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab2/lab2-2.html" title="Task 02. Connect to Overlay IP" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab2/lab2-2.html">
          <b> </b>Task 02. Connect to Overlay IP
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab2/lab2-3.html" title="Task 03. HAWK(High Availability Web Konsole)" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab2/lab2-3.html">
          <b> </b>Task 03. HAWK(High Availability Web Konsole)
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/lab3.html" title="Lab 03. Test Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3.html">
          <b>4. </b>Lab 03. Test Cluster
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/db.html" title="Database Server" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/db.html">
          <b>4.1 </b>Database Server
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/db/lab3-1.html" title="Task 01. Verify Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/db/lab3-1.html">
          <b> </b>Task 01. Verify Cluster
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/db/lab3-2.html" title="Task 02. Stop Database" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/db/lab3-2.html">
          <b>  </b>Task 02. Stop Database
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/db/lab3-3.html" title="Task 03. Crash Database" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/db/lab3-3.html">
          <b> </b>Task 03. Crash Database
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/db/lab3-4.html" title="Task 04. Crash System" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/db/lab3-4.html">
          <b> </b>Task 04. Crash System
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/ap.html" title="Application Server" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/ap.html">
          <b>4.2 </b>Application Server
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/ap/lab3-ap-1.html" title="Task 01. Verify Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/ap/lab3-ap-1.html">
          <b> </b>Task 01. Verify Cluster
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/ap/lab3-ap-2.html" title="Task 02. Migrate ASCS" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/ap/lab3-ap-2.html">
          <b>  </b>Task 02. Migrate ASCS
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab3/ap/lab3-ap-3.html" title="Task 03. Crash System" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab3/ap/lab3-ap-3.html">
          <b>  </b>Task 03. Crash System
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/lab4.html" title="Lab 04. Admin Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab4.html">
          <b>5. </b>Lab 04. Admin Cluster
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab4/lab4-1.html" title="Task 01. Migrate Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab4/lab4-1.html">
          <b> </b>Task 01. Migrate Cluster
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab4/lab4-2.html" title="Task 02. Take a node offline" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab4/lab4-2.html">
          <b> </b>Task 02. Take a node offline
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab4/lab4-3.html" title="Task 03. Perform SAP HANA System Replica" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab4/lab4-3.html">
          <b> </b>Task 03. Perform SAP HANA System Replica
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab4/lab4-4.html" title="Task 04. Test Resource Agent" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab4/lab4-4.html">
          <b> </b>Task 04. Test Resource Agent
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab4/lab4-5.html" title="Task 05 - Upgrade Cluster Software(Optional)" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab4/lab4-5.html">
          <b> </b>Task 05 - Upgrade Cluster Software(Optional)
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/en/lab5.html" title="Lab 05. Change to Cost Optimized Scenario" class="dd-item 
        parent
        
        
        ">
      <a href="../../en/lab5.html">
          <b>6. </b>Lab 05. Change to Cost Optimized Scenario
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/en/lab5/lab5-1.html" title="Task 01. Change HANA HSR Config" class="dd-item 
        parent
        active
        
        ">
      <a href="../../en/lab5/lab5-1.html">
          <b> </b>Task 01. Change HANA HSR Config
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab5/lab5-2.html" title="Task 02. Install SAP HANA DATABASE (QAS)" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab5/lab5-2.html">
          <b> </b>Task 02. Install SAP HANA DATABASE (QAS)
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab5/lab5-3.html" title="Task 03. Change Config of the Cluster for QAS system" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab5/lab5-3.html">
          <b> </b>Task 03. Change Config of the Cluster for QAS system
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/en/lab5/lab5-4.html" title="Task 04. Test Cluster" class="dd-item 
        
        
        
        ">
      <a href="../../en/lab5/lab5-4.html">
          <b> </b>Task 04. Test Cluster
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/en/lab5/lab5-1.html" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="ko" value="/ko/lab5/lab5-1.html">한국어</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2020, Amazon Web Services, Inc. or its affiliates. All rights reserved. 

</left>

    </section>
  </div>
</nav>





  <section id="body">
    <div id="overlay"></div>
    <div class="padding highlightable">
      
      <div>
        <div id="top-bar">
          
          
          <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            
            <span class="links">
              
          
          
          
          
          
          
          
          
          
          
          <a href='../../en/'>Home</a> > <a href='../../en/lab5.html'>Lab 05. Change to Cost Optimized Scenario</a> > Task 01. Change HANA HSR Config
          
          
          
          
          
          
            </span>
          </div>
          
          <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

          
        </div>
      </div>
      

      
        <div id="body-inner">
          <h1>Task 01. Change HANA HSR Config</h1>
          
          



	
<div class="notices note" ><p>Changing the HSR option for QAS system on standby system. We are going to change Global Memory setting.</p>
</div>

<hr>
<ol>
<li>
<p>Connect to sechana through Session Manager.</p>
<ul>
<li>After log in AWS Management Console, connect to <a href="https://console.aws.amazon.com/ec2/v2/home?region=us-east-1#Instances:sort=instanceId" target="_blank">EC2 Instance Console</a></li>
<li>Select <strong>HANA-HDB-Secondary</strong> instance, click <strong>Action</strong>, and click <strong>Connect</strong>.
<img src="lab5-1/images/03-01.png" alt="image03-01"></li>
<li>Select <strong>Session Manager</strong> and click <strong>Connect</strong>.
<img src="lab5-1/images/04.png" alt="image04"></li>
</ul>
</li>
<li>
<p>After connecting as root user, change cluster to maintenance mode and change HSR and Global Memory settings.</p>
<ul>
<li>Change cluster to maintenance mode.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo su - root
crm node maintenance prihana
crm node maintenance sechana
</code></pre></div><ul>
<li>Check crm maintenance status</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">crm_mon -rfn1
</code></pre></div><p><img src="lab5-1/images/05-01.png" alt="image05-01"></p>
</li>
<li>
<p>After connecting as hdbadm<sidadm> user, stop HDB, reduce <strong>memory resource usage</strong> of the secondary SAP HANA DB (sechana), and set <strong>preload option to false</strong>.</p>
<ul>
<li>(sechana) HDB STOP</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">su - hdbadm
HDB stop
</code></pre></div><p><img src="lab5-1/images/06.png" alt="image06"></p>
<ul>
<li>(sechana) Change <strong>global.ini</strong> settings. Open <strong>global.ini</strong> with VI editor. And add the options below.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vi /usr/sap/HDB/SYS/global/hdb/custom/config/global.ini

<span style="color:#f92672">[</span>system_replication<span style="color:#f92672">]</span>
...
preload_column_tables <span style="color:#f92672">=</span> false <span style="color:#75715e">#Add-on</span>

<span style="color:#f92672">[</span>memorymanager<span style="color:#f92672">]</span>
global_allocation_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">24576</span>
</code></pre></div><p><img src="lab5-1/images/07.png" alt="image07"></p>
</li>
<li>
<p>After Takover, change <strong>SAPHanaSR-Hook</strong> so that the existing settings can be restored.</p>
<ul>
<li>(sechana) After log in root user, Back up the script before modifying SAPHanaSR.py.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">exit
cd /usr/share/SAPHanaSR/
cp -pr SAPHanaSR.py SAPHanaSR.py.default
</code></pre></div><ul>
<li>(sechana) Modify the SAPHanaSR.py script as follows:
<ul>
<li>Block 1(AS-Is)
<img src="lab5-1/images/08.png" alt="image08"></li>
<li>Block 1(To-Be)
<img src="lab5-1/images/08-01.png" alt="image08-01"></li>
<li>Block 2(AS-Is)
<img src="lab5-1/images/09.png" alt="image09"></li>
<li>Block 2(To-Be)
<img src="lab5-1/images/09-01.png" alt="image09-01"></li>
<li>Please modify the script as below.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vi SAPHanaSR.py

<span style="color:#75715e"># Block 1</span>
from hdb_ha_dr.client import HADRBase, Helper
import os, time
from hdbcli import dbapi

dbuser <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SYSTEM&#34;</span>
dbpwd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Init12345!&#34;</span>
dbport <span style="color:#f92672">=</span> <span style="color:#ae81ff">30013</span>
stmnt1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ALTER SYSTEM ALTER CONFIGURATION (&#39;global.ini&#39;,&#39;SYSTEM&#39;) UNSET (&#39;memorymanager&#39;,&#39;global_allocation_limit&#39;) WITH RECONFIGURE&#34;</span>
stmnt2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ALTER SYSTEM ALTER CONFIGURATION (&#39;global.ini&#39;,&#39;SYSTEM&#39;) UNSET (&#39;system_replication&#39;,&#39;preload_column_tables&#39;) WITH RECONFIGURE&#34;</span>

<span style="color:#75715e"># Block 2</span>
def postTakeover<span style="color:#f92672">(</span>self, rc, **kwargs<span style="color:#f92672">)</span>:
<span style="color:#e6db74">&#34;&#34;&#34;Post takeover hook.&#34;&#34;&#34;</span>
self.tracer.info<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%s.postTakeover method called with rc=%s&#34;</span> % <span style="color:#f92672">(</span>self.__class__.__name__, rc<span style="color:#f92672">))</span>
<span style="color:#66d9ef">if</span> rc <span style="color:#f92672">==</span> 0:
  <span style="color:#75715e"># normal takeover succeeded</span>
  conn <span style="color:#f92672">=</span> dbapi.connect<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;localhost&#39;</span>, dbport, dbuser, dbpwd<span style="color:#f92672">)</span>
  cursor <span style="color:#f92672">=</span> conn.cursor<span style="color:#f92672">()</span>
  cursor.execute<span style="color:#f92672">(</span>stmnt1<span style="color:#f92672">)</span>
  cursor.execute<span style="color:#f92672">(</span>stmnt2<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">elif</span> rc <span style="color:#f92672">==</span> 1:
  <span style="color:#75715e"># waiting for force takeover</span>
  conn <span style="color:#f92672">=</span> dbapi.connect<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;localhost&#39;</span>, dbport, dbuser, dbpwd<span style="color:#f92672">)</span>
  cursor <span style="color:#f92672">=</span> conn.cursor<span style="color:#f92672">()</span>
  cursor.execute<span style="color:#f92672">(</span>stmnt1<span style="color:#f92672">)</span>
  cursor.execute<span style="color:#f92672">(</span>stmnt2<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">elif</span> rc <span style="color:#f92672">==</span> 2:
  <span style="color:#75715e"># error, something went wrong</span>
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p>After connecting as hdbadm<sidadm> user, start HDB, and perform TAKEOVER TEST.</p>
<ul>
<li>(sechana) HDB START</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">su - hdbadm
HDB start
</code></pre></div><p><img src="lab5-1/images/10.png" alt="image10"></p>
<ul>
<li>(sechana) Check HSR status.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hdbnsutil -sr_state
</code></pre></div><p><img src="lab5-1/images/11.png" alt="image11"></p>
<ul>
<li>(sechana) takeover to sechana</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hdbnsutil -sr_takeover
</code></pre></div><p><img src="lab5-1/images/12.png" alt="image12"></p>
<ul>
<li>(sechana) After Takeover, check whether <strong>global.ini setting is restored</strong> by SAPHanaSR.py.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cat /usr/sap/HDB/SYS/global/hdb/custom/config/global.ini
</code></pre></div><p><img src="lab5-1/images/13.png" alt="image13"></p>
<ul>
<li>Since HA Cluster is currently in maintenance mode, automatic Takeover or Takeback using HA Cluster is not possible. To restore HSR to its original state, manually reset the HSR in the following order.</li>
<li>Keep the connection of sechana, and also connect to prihana through Session Manager.
<ul>
<li>Connect to <a href="https://console.aws.amazon.com/ec2/v2/home?region=us-east-1#Instances:sort=instanceId" target="_blank">EC2 Instance Console</a>.</li>
<li>Select <strong>HANA-HDB-Primary</strong> instance, click <strong>Action</strong>, and click <strong>Connect</strong>.
<img src="lab5-1/images/03.png" alt="image03-01"></li>
<li>Select <strong>Session Manager</strong> and click <strong>Connect</strong>.
<img src="lab5-1/images/04.png" alt="image04"></li>
</ul>
</li>
<li>(prihana) After connecting as hdbadm<sidadm> user, execute sr_register as seconadry Database</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo su - hdbadm
HDB stop

hdbnsutil -sr_register --remoteHost<span style="color:#f92672">=</span>sechana --remoteInstance<span style="color:#f92672">=</span><span style="color:#ae81ff">00</span> --replicationMode<span style="color:#f92672">=</span>sync --name<span style="color:#f92672">=</span>HAP --operationMode<span style="color:#f92672">=</span>logreplay
HDB start
</code></pre></div><p><img src="lab5-1/images/14.png" alt="image14"></p>
<ul>
<li>(prihana) Check the synchronization status</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hdbnsutil -sr_state
</code></pre></div><p><img src="lab5-1/images/15.png" alt="image15"></p>
<ul>
<li>(prihana) takeback to prihana</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hdbnsutil -sr_takeover
</code></pre></div><p><img src="lab5-1/images/16.png" alt="image16"></p>
<ul>
<li>(sechana) After connecting as hdbadm<sidadm> user, execute sr_register as seconadry Database</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">su - hdbadm
HDB stop

hdbnsutil -sr_register --remoteHost<span style="color:#f92672">=</span>prihana --remoteInstance<span style="color:#f92672">=</span><span style="color:#ae81ff">00</span> --replicationMode<span style="color:#f92672">=</span>sync --name<span style="color:#f92672">=</span>HAS --operationMode<span style="color:#f92672">=</span>logreplay
</code></pre></div><p><img src="lab5-1/images/17.png" alt="image17"></p>
<ul>
<li>(sechana) Change <strong>global.ini</strong> settings. Open <strong>global.ini</strong> with VI editor. And add the options below.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">vi /usr/sap/HDB/SYS/global/hdb/custom/config/global.ini

<span style="color:#f92672">[</span>system_replication<span style="color:#f92672">]</span>
...
preload_column_tables <span style="color:#f92672">=</span> false <span style="color:#75715e">#Add-on</span>

<span style="color:#f92672">[</span>memorymanager<span style="color:#f92672">]</span>
global_allocation_limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">24576</span>
</code></pre></div><p><img src="lab5-1/images/07.png" alt="image07"></p>
<ul>
<li>(sechana) After connecting as hdbadm<sidadm> user, HDB start</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">HDB start
</code></pre></div><p><img src="lab5-1/images/18.png" alt="image18"></p>
</li>
</ol>
<hr>
<p align="center">
© 2020, Amazon Web Services, Inc. or its affiliates. All rights reserved.
</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../en/lab5.html" title="Lab 05. Change to Cost Optimized Scenario"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../en/lab5/lab5-2.html" title="Task 02. Install SAP HANA DATABASE (QAS)" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js"></script>
    <script src="../../js/perfect-scrollbar.min.js"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../../js/jquery.sticky.js"></script>
    <script src="../../js/featherlight.min.js"></script>
    <script src="../../js/html5shiv-printshiv.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js"></script>
    <script src="../../js/learn.js"></script>
    <script src="../../js/hugo-learn.js"></script>

    <link href="../../mermaid/mermaid.css" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
  </body>
</html>
